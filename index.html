<!DOCTYPE html>
<html>
<head>
  <title>Speed Type</title>
  <style>
    body { background:white; font-family:Arial; text-align:center; }
    canvas { border:2px solid black; display:block; margin:20px auto; background:#eee; }
    .menu button { margin:10px; padding:10px 20px; font-size:18px; }
    .garage-car, .shop-car {
      display:inline-block; margin:10px; padding:10px;
      border:2px solid black; cursor:pointer; position:relative;
    }
    .selected { border:3px solid gold; }
  </style>
</head>
<body>
  <h1>ðŸš— Speed Type ðŸš—</h1>
  <div id="menu" class="menu">
    <button onclick="showRace()">Start Race</button>
    <button onclick="showGarage()">Garage</button>
    <button onclick="showShop()">Shop</button>
    <button onclick="showProfile()">Profile</button>
  </div>

  <canvas id="gameCanvas" width="800" height="400" style="display:none;"></canvas>
  <div id="wordBox" style="display:none;">
    <p id="word"></p>
    <input id="typeBox" type="text" autocomplete="off"/>
    <p id="result"></p>
  </div>

  <div id="garage" style="display:none;">
    <h2>Garage</h2>
    <div id="carOptions"></div>
    <button onclick="backToMenu()">Back</button>
  </div>

  <div id="shop" style="display:none;">
    <h2>Shop</h2>
    <div id="shopOptions"></div>
    <p>Coins: <span id="coins"></span></p>
    <button onclick="backToMenu()">Back</button>
  </div>

  <div id="profile" style="display:none;">
    <h2>Profile</h2>
    <p>Name: <input id="nameInput" type="text" /></p>
    <button onclick="saveName()">Save</button>
    <button onclick="backToMenu()">Back</button>
  </div>

  <script>
  const $ = id => document.getElementById(id);

  // Game state
  let state = {
    name: "Player",
    coins: 0,
    unlocked: ["red"], // start with red car
    selectedCar: "red"
  };

  // Cars
  const cars = [
    {id:"red", color:"red", price:0},
    {id:"blue", color:"blue", price:50},
    {id:"green", color:"green", price:100},
    {id:"yellow", color:"yellow", price:200},
    {id:"admin", color:"black", price:0} // special
  ];

  // Admin car image (replace with your top view car)
  let adminCarImg = new Image();
  adminCarImg.src = "car.png"; // replace with generated car file

  // Words for race
  const words = ["pizza","pasta","amore","ciao","vino","colosseo","mario","luigi","formaggio","espresso"];

  // Save/load
  function save(){ localStorage.setItem("speedtype", JSON.stringify(state)); }
  function load(){ let s = localStorage.getItem("speedtype"); if(s) state = JSON.parse(s); }
  load();

  // Menu navigation
  function backToMenu(){
    $("gameCanvas").style.display="none";
    $("wordBox").style.display="none";
    $("garage").style.display="none";
    $("shop").style.display="none";
    $("profile").style.display="none";
    $("menu").style.display="block";
  }

  // RACE
  let phrases = [];
  let currentIndex = 0;
  let playerX = 40, botX = 40, finish = 720, raceOver = false;

  function showRace(){
    $("menu").style.display="none";
    $("garage").style.display="none";
    $("shop").style.display="none";
    $("profile").style.display="none";
    $("gameCanvas").style.display="block";
    $("wordBox").style.display="block";
    startRace();
  }

  function startRace(){
    phrases = [ words[Math.floor(Math.random()*words.length)], words[Math.floor(Math.random()*words.length)] ];
    currentIndex = 0;
    $("word").textContent = phrases[currentIndex];
    $("typeBox").value = "";
    $("result").textContent = "";
    playerX = 40; botX = 40; raceOver = false;
    draw();
    botRace();
  }

  $("typeBox").addEventListener("input", ()=>{
    if(raceOver) return;
    if($("typeBox").value.trim() === phrases[currentIndex]){
      playerX += 300; // move forward
      $("typeBox").value = "";
      currentIndex++;
      if(currentIndex < phrases.length){
        $("word").textContent = phrases[currentIndex];
      } else {
        $("result").textContent = "You finished! ðŸŽ‰";
        state.coins += 20;
        save();
        raceOver = true;
      }
      draw();
    }
  });

  function botRace(){
    let botIndex = 0;
    function step(){
      if(raceOver) return;
      if(botIndex < phrases.length){
        botX += 300;
        botIndex++;
        draw();
        if(botIndex === phrases.length){
          $("result").textContent = "Bot finished! ðŸ˜¢";
          raceOver = true;
          return;
        }
        setTimeout(step, 2000 + Math.random()*2000);
      }
    }
    setTimeout(step, 3000);
  }

  function draw(){
    let ctx = $("gameCanvas").getContext("2d");
    ctx.clearRect(0,0,800,400);
    ctx.fillStyle = "gray";
    ctx.fillRect(0,150,800,100);

    // Player car
    let car = cars.find(c=>c.id===state.selectedCar);
    if(car.id === "admin"){
      ctx.drawImage(adminCarImg, playerX, 160, 60, 30);
    } else {
      ctx.fillStyle = car.color;
      ctx.fillRect(playerX, 160, 60, 30);
    }

    // Bot car
    ctx.fillStyle = "purple";
    ctx.fillRect(botX, 200, 60, 30);

    // Finish line
    ctx.fillStyle = "black";
    ctx.fillRect(finish, 150, 10, 100);
  }

  // GARAGE
  function showGarage() {
    $("menu").style.display="none";
    $("garage").style.display="block";
    $("carOptions").innerHTML = "";

    cars.forEach(car => {
      let c = document.createElement("div");
      c.className = "garage-car";
      if (car.id === state.selectedCar) c.classList.add("selected");

      if (car.id === "admin") {
        let img = document.createElement("img");
        img.src = adminCarImg.src;
        img.width = 60;
        img.height = 30;

        if (state.name !== "ownedkid") {
          img.style.filter = "grayscale(100%) opacity(60%)";
          c.appendChild(img);

          let lock = document.createElement("div");
          lock.style.position = "absolute";
          lock.style.width = "60px";
          lock.style.height = "30px";
          lock.style.background = "rgba(0,0,0,0.5)";
          lock.style.display = "flex";
          lock.style.alignItems = "center";
          lock.style.justifyContent = "center";
          lock.style.color = "white";
          lock.style.fontWeight = "bold";
          lock.textContent = "ðŸ”’";
          c.style.position = "relative";
          c.appendChild(lock);
        } else {
          c.appendChild(img);
          c.onclick = () => { state.selectedCar = car.id; save(); showGarage(); };
        }

      } else if (state.unlocked.includes(car.id)) {
        c.style.background = car.color;
        c.style.width="60px"; c.style.height="30px";
        c.onclick = () => { state.selectedCar = car.id; save(); showGarage(); };
      }

      $("carOptions").appendChild(c);
    });
  }

  // SHOP
  function showShop() {
    $("menu").style.display="none";
    $("shop").style.display="block";
    $("shopOptions").innerHTML = "";
    $("coins").textContent = state.coins;

    cars.forEach(car => {
      if (car.id === "admin") {
        let c = document.createElement("div");
        c.className = "shop-car";

        let img = document.createElement("img");
        img.src = adminCarImg.src;
        img.width = 60;
        img.height = 30;

        if (state.name !== "ownedkid") {
          img.style.filter = "grayscale(100%) opacity(60%)";
          c.appendChild(img);
          c.innerHTML += "<p>Admin Supercar ðŸ”’</p>";
        } else {
          c.appendChild(img);
          c.innerHTML += "<p>Admin Supercar (free)</p>";
          let btn = document.createElement("button");
          btn.innerText = "Select";
          btn.onclick = () => { state.selectedCar = "admin"; save(); alert("Admin Supercar equipped!"); };
          c.appendChild(btn);
        }

        $("shopOptions").appendChild(c);
        return;
      }

      if (!state.unlocked.includes(car.id)) {
        let c = document.createElement("div");
        c.className = "shop-car";
        c.innerHTML = "<div style='width:60px;height:30px;background:"+car.color+";border:2px solid black;'></div>";
        c.innerHTML += "<p>"+car.id+" - "+car.price+" coins</p>";

        let btn = document.createElement("button");
        btn.innerText = "Buy";
        btn.onclick = () => {
          if (state.coins >= car.price) {
            state.coins -= car.price;
            state.unlocked.push(car.id);
            save();
            showShop();
          } else {
            alert("Not enough coins!");
          }
        };

        c.appendChild(btn);
        $("shopOptions").appendChild(c);
      }
    });
  }

  // PROFILE
  function showProfile(){
    $("menu").style.display="none";
    $("profile").style.display="block";
    $("nameInput").value = state.name;
  }
  function saveName(){
    state.name = $("nameInput").value.trim() || "Player";
    save();
    alert("Name saved!");
  }
  </script>
</body>
</html>
