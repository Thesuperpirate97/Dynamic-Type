<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Speed Type üèéÔ∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #ffffff;
      --panel: #f5f5f5;
      --ink: #111;
      --accent: #0d6efd;
      --border: #000;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      text-align: center;
    }
    h1 { font-size: 44px; margin: 16px 0 4px; }
    .sub { margin: 0 0 12px; color: #555; }
    .wrap {
      max-width: 1050px;
      margin: 0 auto;
      padding: 12px;
    }
    .row { display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; }
    .card {
      background: var(--panel);
      border: 3px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      box-shadow: 4px 4px 0 #0003;
    }
    .menu { padding: 18px; }
    button {
      cursor: pointer;
      border: 3px solid var(--border);
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 18px;
      background: #fff;
      transition: transform .06s ease;
    }
    button:active { transform: translateY(1px); }
    .primary { background: #00a86b; color: #fff; }
    .warn { background: #ffc107; }
    .danger { background: #e03131; color:#fff; }
    .muted { background: #e9ecef; }
    canvas {
      border: 3px solid #000;
      display: block;
      margin: 12px auto;
      background: var(--panel);
    }
    #word { font-size: 26px; margin-top: 6px; }
    #typed { font-size: 22px; min-height: 28px; }
    #winner { font-size: 28px; margin-top: 10px; color: #e03131; min-height: 34px; }
    .progress-title { margin: 4px 0; }
    .progress-container {
      width: 90%;
      height: 18px;
      background: #ddd;
      border: 2px solid #000;
      margin: 8px auto;
      border-radius: 9px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      text-align: right;
      padding-right: 6px;
      color: #fff;
      font-size: 12px;
      line-height: 18px;
      white-space: nowrap;
    }
    #scoreboard { margin-top: 10px; font-size: 18px; }
    .hidden { display: none !important; }
    .shop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      width: 100%;
    }
    .shop-item {
      background: #fff;
      border: 3px solid #000;
      border-radius: 12px;
      padding: 10px;
    }
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border: 2px solid #000;
      border-radius: 999px;
      background: #ffd43b;
      font-size: 14px;
      margin-bottom: 6px;
    }
    .coinbox {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 6px 10px; border: 3px solid #000; border-radius: 999px;
      background: #fff;
      font-weight: 700;
    }
    .coin { width: 14px; height: 14px; border-radius: 50%; background: gold; border: 2px solid #000; display:inline-block; }
    input[type="text"] { padding: 8px 12px; font-size: 18px; border: 2px solid #000; border-radius: 10px; }
    .spacer { height: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Speed Type</h1>
    <p class="sub">Type one word to win. Earn coins, buy cars, flex in style ü§å</p>

    <!-- COINS always visible -->
    <div class="coinbox" id="coinbox"><span class="coin"></span><span id="coinCount">0</span> coins</div>

    <!-- MENU -->
    <div id="menu" class="card menu">
      <div class="row">
        <button class="primary" onclick="startRace()">Start Race</button>
        <button class="warn" onclick="openGarage()">Garage</button>
        <button class="warn" onclick="openShop()">Shop</button>
        <button class="muted" onclick="openProfile()">Profile</button>
        <button class="danger" onclick="quitGame()">Quit</button>
      </div>
    </div>

    <!-- GARAGE -->
    <div id="garage" class="card hidden">
      <h2>Garage üöó ‚Äî choose your car</h2>
      <p class="sub">Select from your unlocked cars.</p>
      <div id="garageList" class="shop-grid"></div>
      <div class="spacer"></div>
      <button class="muted" onclick="backToMenu()">Back</button>
    </div>

    <!-- SHOP -->
    <div id="shop" class="card hidden">
      <h2>Shop üõí</h2>
      <p class="sub">Win races to earn coins, then unlock new rides.</p>
      <div id="shopList" class="shop-grid"></div>
      <div class="spacer"></div>
      <button class="muted" onclick="backToMenu()">Back</button>
    </div>

    <!-- PROFILE -->
    <div id="profile" class="card hidden">
      <h2>Profile üë§</h2>
      <p>Enter your display name:</p>
      <input type="text" id="playerNameInput" placeholder="Your name" />
      <div class="spacer"></div>
      <div class="row">
        <button class="primary" onclick="saveProfile()">Save</button>
        <button class="muted" onclick="backToMenu()">Back</button>
      </div>
    </div>

    <!-- GAME -->
    <div id="game" class="card hidden">
      <canvas id="gameCanvas" width="1000" height="420"></canvas>
      <div id="word"></div>
      <div id="typed"></div>

      <h3 class="progress-title">Progress</h3>
      <div class="progress-container"><div id="progress1" class="progress-bar" style="background:#0ea5e9;">Player</div></div>
      <div class="progress-container"><div id="progress2" class="progress-bar" style="background:#ef4444;">Player 2</div></div>
      <div class="progress-container"><div id="progress3" class="progress-bar" style="background:#22c55e;">Player 3</div></div>

      <div id="winner"></div>
      <div class="row" style="justify-content:center;">
        <button id="restartBtn" class="primary hidden" onclick="resetRace()">Restart Race</button>
        <button class="muted" onclick="backToMenu()">Back to Menu</button>
      </div>

      <div id="scoreboard"></div>
    </div>
  </div>

  <script>
    /**************
     * DATA MODEL *
     **************/
    const words = ["pizza","spaghetti","mamma","ciao","italia","vespa","colosseum","pasta","gelato","opera"];

    // Car catalog (AI-styled SVG sprites, ‚Äúsemi-realistic cartoon‚Äù)
    // Each car has: id, name, price, accent color, body shape variant
    const carCatalog = [
      { id:"starter-blue", name:"Starter Blue", price:0, color:"#0ea5e9", variant:1 },
      { id:"rosso-sport", name:"Rosso Sport", price:15, color:"#e03131", variant:2 },
      { id:"verde-turbo", name:"Verde Turbo", price:20, color:"#2f9e44", variant:3 },
      { id:"giallo-gt", name:"Giallo GT", price:25, color:"#ffd43b", variant:2 },
      { id:"notte-phantom", name:"Notte Phantom", price:30, color:"#111", variant:4 },
      { id:"bianco-aurora", name:"Bianco Aurora", price:30, color:"#e9ecef", variant:3, stroke:"#000" },
      { id:"viola-drift", name:"Viola Drift", price:35, color:"#7c3aed", variant:4 },
      { id:"arancio-rally", name:"Arancio Rally", price:40, color:"#ff7f22", variant:1 }
    ];

    // Local/persistent state
    const store = {
      coins: 0,
      unlocked: new Set(["starter-blue"]),
      selectedCar: "starter-blue",
      playerName: "You",
      scores: { player: 0, bot1: 0, bot2: 0 }
    };

    // Try load from localStorage
    (function loadPersist() {
      try {
        const raw = localStorage.getItem("speedtype_profile");
        if (raw) {
          const obj = JSON.parse(raw);
          if (Number.isFinite(obj.coins)) store.coins = obj.coins;
          if (obj.unlocked && Array.isArray(obj.unlocked)) store.unlocked = new Set(obj.unlocked);
          if (obj.selectedCar) store.selectedCar = obj.selectedCar;
          if (obj.playerName) store.playerName = obj.playerName;
          if (obj.scores) store.scores = obj.scores;
        }
      } catch {}
      updateCoinUI();
    })();

    function persist() {
      const snapshot = {
        coins: store.coins,
        unlocked: Array.from(store.unlocked),
        selectedCar: store.selectedCar,
        playerName: store.playerName,
        scores: store.scores
      };
      localStorage.setItem("speedtype_profile", JSON.stringify(snapshot));
      updateCoinUI();
    }

    /*******************
     * SIMPLE ROUTER   *
     *******************/
    const $ = (id) => document.getElementById(id);
    function show(id) {
      ["menu","garage","shop","profile","game"].forEach(x => $(x).classList.add("hidden"));
      $(id).classList.remove("hidden");
    }
    function backToMenu() { show("menu"); }

    /*******************
     * SVG CAR SPRITES *
     *******************/
    // Generates a ‚Äúsemi-realistic cartoon‚Äù car as SVG string for given color + variant
    function carSVG(color = "#0ea5e9", variant = 1, strokeOverride=null) {
      const stroke = strokeOverride || "#111";
      // Slightly different silhouettes by variant
      const bodies = {
        1: "M60,50 C110,20 210,20 260,50 L300,60 L300,85 C300,100 290,110 275,110 L85,110 C70,110 60,100 60,85 Z",
        2: "M55,60 C120,15 200,15 265,60 L300,70 L300,92 C300,108 288,118 270,118 L85,118 C70,118 55,108 55,92 Z",
        3: "M65,58 C125,28 195,28 255,58 L300,70 L300,96 C300,110 290,120 275,120 L85,120 C70,120 65,110 65,96 Z",
        4: "M58,55 C118,10 208,10 268,55 L300,68 L300,95 C300,110 292,122 275,122 L85,122 C68,122 58,112 58,95 Z",
      };
      const glass = "M120,60 L235,60 C248,60 255,70 250,82 L235,110 L140,110 L120,82 C115,70 122,60 135,60 Z";
      const grill = "M260,100 h20 v8 h-20 z";
      const headlightL = "M285,95 a8,8 0 1 1 0.1,0";
      const tail = "M70,95 h-12 v8 h12 z";
      // wheels
      const wheelL = { cx: 115, cy: 118, r: 16 };
      const wheelR = { cx: 235, cy: 118, r: 16 };
      // stripe accent: subtle sporty stripe
      const stripe = "M150,70 l100,10 l-6,18 l-100,-10 z";

      return `
<svg xmlns="http://www.w3.org/2000/svg" width="360" height="160" viewBox="0 0 360 160">
  <defs>
    <linearGradient id="paint" x1="0" x2="1" y1="0" y2="1">
      <stop offset="0%" stop-color="${color}" stop-opacity="1"/>
      <stop offset="100%" stop-color="${color}" stop-opacity="0.85"/>
    </linearGradient>
  </defs>
  <rect x="0" y="0" width="360" height="160" fill="none"/>
  <path d="${bodies[variant]}" fill="url(#paint)" stroke="${stroke}" stroke-width="3" />
  <path d="${glass}" fill="#cbe7ff" stroke="${stroke}" stroke-width="2"/>
  <path d="${stripe}" fill="#ffffff55"/>
  <rect x="210" y="88" width="36" height="6" rx="3" fill="#ffffff66"/>
  <rect x="80" y="88" width="18" height="6" rx="3" fill="#ffffff66"/>
  <path d="${grill}" fill="#222" stroke="${stroke}" stroke-width="2"/>
  <circle cx="${wheelL.cx}" cy="${wheelL.cy}" r="${wheelL.r}" fill="#222" stroke="${stroke}" stroke-width="3"/>
  <circle cx="${wheelR.cx}" cy="${wheelR.cy}" r="${wheelR.r}" fill="#222" stroke="${stroke}" stroke-width="3"/>
  <circle cx="${wheelL.cx}" cy="${wheelL.cy}" r="${wheelL.r - 7}" fill="#777"/>
  <circle cx="${wheelR.cx}" cy="${wheelR.cy}" r="${wheelR.r - 7}" fill="#777"/>
  <path d="${headlightL}" fill="#ffd43b" stroke="${stroke}" stroke-width="2"/>
  <rect x="60" y="94" width="10" height="10" fill="#ff4d4f" stroke="${stroke}" stroke-width="2"/>
  <path d="${tail}" fill="#ff4d4f" stroke="${stroke}" stroke-width="2"/>
</svg>`;
    }

    function carImageFor(carId) {
      const meta = carCatalog.find(c => c.id === carId) || carCatalog[0];
      const svg = carSVG(meta.color, meta.variant, meta.stroke);
      const img = new Image();
      img.src = "data:image/svg+xml;utf8," + encodeURIComponent(svg);
      return img;
    }

    /*****************
     * GAME RUNTIME  *
     *****************/
    let currentWord = "";
    let typedWord = "";
    let playerX=50, playerY=250, bot1X=50, bot1Y=180, bot2X=50, bot2Y=320;
    const finishX = 900;
    let winner = null;
    let raceStarted = false;
    let animating = false;

    const canvas = $("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Bot visuals
    const bot1Img = (function(){ const i = new Image(); i.src = "data:image/svg+xml;utf8," + encodeURIComponent(carSVG("#ef4444",2)); return i; })();
    const bot2Img = (function(){ const i = new Image(); i.src = "data:image/svg+xml;utf8," + encodeURIComponent(carSVG("#22c55e",3)); return i; })();

    function resetRace() {
      currentWord = words[Math.floor(Math.random()*words.length)];
      typedWord = "";
      playerX=50; playerY=250;
      bot1X=50; bot1Y=180;
      bot2X=50; bot2Y=320;
      winner = null; raceStarted = true; animating = false;
      $("winner").textContent = "";
      $("restartBtn").classList.add("hidden");
      updateProgress();
      requestAnimationFrame(update);
    }

    function drawCars() {
      // track stripe
      ctx.strokeStyle = "#000"; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(finishX, 0); ctx.lineTo(finishX, canvas.height); ctx.stroke();

      // player car
      const playerImg = carImageFor(store.selectedCar);
      ctx.drawImage(playerImg, playerX-40, playerY-60, 160, 100);
      // bots
      ctx.drawImage(bot1Img, bot1X-40, bot1Y-60, 160, 100);
      ctx.drawImage(bot2Img, bot2X-40, bot2Y-60, 160, 100);
    }

    function updateProgress() {
      $("progress1").style.width = Math.min((playerX/finishX)*100,100) + "%";
      $("progress1").textContent = store.playerName;
      $("progress2").style.width = Math.min((bot1X/finishX)*100,100) + "%";
      $("progress2").textContent = "Player 2";
      $("progress3").style.width = Math.min((bot2X/finishX)*100,100) + "%";
      $("progress3").textContent = "Player 3";
    }

    function updateScoreboard() {
      $("scoreboard").innerHTML = `
        <h3>Scoreboard</h3>
        ${store.playerName}: ${store.scores.player} wins<br>
        Player 2: ${store.scores.bot1} wins<br>
        Player 3: ${store.scores.bot2} wins
      `;
    }

    function awardCoinsOnWin() {
      // +5 coins per win
      store.coins += 5;
      persist();
    }

    function updateCoinUI() { $("coinCount").textContent = store.coins; }

    function declareWinner(name, key) {
      winner = name;
      $("winner").textContent = `${name} WON! (+5 coins)`;
      $("restartBtn").classList.remove("hidden");
      if (key === "player") store.scores.player++;
      if (key === "bot1") store.scores.bot1++;
      if (key === "bot2") store.scores.bot2++;
      awardCoinsOnWin();
      updateScoreboard();
      persist();
      raceStarted = false;
    }

    function update() {
      if (raceStarted && !winner) {
        // slow bots
        bot1X += Math.random()*0.9 + 0.5;
        bot2X += Math.random()*0.9 + 0.5;

        if (playerX >= finishX) declareWinner(store.playerName, "player");
        else if (bot1X >= finishX) declareWinner("Player 2", "bot1");
        else if (bot2X >= finishX) declareWinner("Player 3", "bot2");
      }

      ctx.clearRect(0,0,canvas.width, canvas.height);
      drawCars();
      updateProgress();

      $("word").textContent = "Word: " + currentWord;
      $("typed").textContent = typedWord;

      if (!winner) requestAnimationFrame(update);
    }

    document.addEventListener("keydown", (e) => {
      if ($("game").classList.contains("hidden")) return;
      if (winner) return;

      if (e.key === "Backspace") {
        typedWord = typedWord.slice(0, -1);
      } else if (e.key === "Enter") {
        if (typedWord === currentWord && !animating) {
          // Animate quickly to finish
          animating = true;
          const step = () => {
            playerX += 24; // faster
            if (playerX >= finishX) {
              playerX = finishX; animating = false;
            } else {
              requestAnimationFrame(step);
            }
          };
          requestAnimationFrame(step);
        } else {
          typedWord = "";
        }
      } else if (e.key.length === 1) {
        typedWord += e.key;
      }
    });

    /**************
     * NAV / MENUS
     **************/
    function startRace() { show("game"); resetRace(); updateScoreboard(); }
    function openGarage() { renderGarage(); show("garage"); }
    function openShop() { renderShop(); show("shop"); }
    function openProfile() {
      $("playerNameInput").value = store.playerName;
      show("profile");
    }
    function saveProfile() {
      const v = $("playerNameInput").value.trim();
      if (v) store.playerName = v;
      persist();
      backToMenu();
    }
    function quitGame() { alert("Thanks for playing Speed Type! ü§å"); }

    /********
     * SHOP *
     ********/
    function renderShop() {
      const container = $("shopList");
      container.innerHTML = "";
      carCatalog.forEach(car => {
        const owned = store.unlocked.has(car.id);
        const canAfford = store.coins >= car.price;
        const div = document.createElement("div");
        div.className = "shop-item";

        // preview image
        const img = new Image();
        img.src = "data:image/svg+xml;utf8," + encodeURIComponent(carSVG(car.color, car.variant, car.stroke));
        img.style.width = "100%";
        img.style.height = "120px";
        img.style.objectFit = "contain";

        const title = document.createElement("div");
        title.style.fontWeight = "700";
        title.style.margin = "6px 0";
        title.textContent = car.name;

        const price = document.createElement("div");
        price.innerHTML = car.price === 0 ? `<span class="badge">Owned</span>` :
          `<span class="badge"><span class="coin"></span> ${car.price}</span>`;

        const btn = document.createElement("button");
        if (owned) {
          btn.textContent = "Owned";
          btn.disabled = true;
          btn.className = "muted";
        } else if (canAfford) {
          btn.textContent = "Buy";
          btn.className = "primary";
          btn.onclick = () => {
            store.coins -= car.price;
            store.unlocked.add(car.id);
            persist();
            renderShop();
          };
        } else {
          btn.textContent = "Need coins";
          btn.disabled = true;
          btn.className = "muted";
        }

        div.append(img, title, price, btn);
        container.appendChild(div);
      });
    }

    /***********
     * GARAGE  *
     ***********/
    function renderGarage() {
      const container = $("garageList");
      container.innerHTML = "";
      carCatalog.forEach(car => {
        if (!store.unlocked.has(car.id)) return;
        const div = document.createElement("div");
        div.className = "shop-item";

        const img = new Image();
        img.src = "data:image/svg+xml;utf8," + encodeURIComponent(carSVG(car.color, car.variant, car.stroke));
        img.style.width = "100%";
        img.style.height = "120px";
        img.style.objectFit = "contain";

        const label = document.createElement("div");
        label.style.fontWeight = "700";
        label.style.margin = "6px 0";
        label.textContent = car.name;

        const btn = document.createElement("button");
        if (store.selectedCar === car.id) {
          btn.textContent = "Selected";
          btn.disabled = true;
          btn.className = "muted";
        } else {
          btn.textContent = "Select";
          btn.className = "primary";
          btn.onclick = () => {
            store.selectedCar = car.id;
            persist();
            renderGarage();
          };
        }

        div.append(img, label, btn);
        container.appendChild(div);
      });
    }

    // Initial scoreboard + coins UI in menu
    updateScoreboard();

  </script>
</body>
</html>
